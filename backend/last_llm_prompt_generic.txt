
ROLE: Senior Database Performance Architect.
TASK: Analyze this database health snapshot and the calculated score.

SCORING POLICY:
Calculated Score: 90/100
Deductions:
-5 pts: Query -3884425969539893064 impacts >10% of DB time
-5 pts: Moderate bloat in usm-auth.user_secretes

INPUT DATA:
1. WORKLOAD SUMMARY:
Query -3884425969539893064 (17733 calls, 10.6% DB Load): select s.*, extract($1 from s.lastattempt) as lastattempt_ts from rds_get_stat_connections_counters() as s where s.lastattempt > (now() - interval $2 second) limit $3...
Query -5215524276360263312 (1773 calls, 6.1% DB Load): SELECT count(*) FROM pg_show_all_settings() WHERE name = 'shared_preload_libraries' AND setting SIMILAR TO 'rdsutils|rdsutils,%'...
Query 288360640087737634 (317 calls, 5.0% DB Load): SELECT
                        
            CAST(queryid AS TEXT) AS queryid,
            query,
            (total_exec_time + COALESCE(total_plan_time, $1))::BIGINT AS total_time,
            calls:...
Query 8602147935427000334 (1996 calls, 4.1% DB Load): SELECT "User"."id" AS "User_id", "User"."name" AS "User_name", "User"."firstName" AS "User_firstName", "User"."lastName" AS "User_lastName", "User"."username" AS "User_username", "User"."email" AS "Us...
Query 676680361616409992 (2064 calls, 3.4% DB Load): SELECT "User"."id" AS "User_id", "User"."name" AS "User_name", "User"."firstName" AS "User_firstName", "User"."lastName" AS "User_lastName", "User"."username" AS "User_username", "User"."email" AS "Us...
Query -3146807096129156104 (74433 calls, 2.7% DB Load): SELECT count(*) FROM information_schema.tables WHERE table_catalog = $1 and table_name = $2...
Query 5944082444815859406 (317 calls, 2.1% DB Load): SELECT COUNT(*) FROM pg_stat_statements WHERE $1=$2 AND query NOT ILIKE $3 AND query NOT ILIKE $4 AND query NOT ILIKE $5 AND query NOT ILIKE $6 AND query NOT ILIKE $7 AND query NOT ILIKE $8 AND query ...
Query -601833048549239672 (8023 calls, 1.7% DB Load): SELECT "UserRolesEntity"."id" AS "UserRolesEntity_id", "UserRolesEntity"."user_id" AS "UserRolesEntity_user_id", "UserRolesEntity"."tenant_id" AS "UserRolesEntity_tenant_id", "UserRolesEntity"."role_i...
Query -6590238534363480000 (167 calls, 1.4% DB Load): SELECT
                        
            CAST(queryid AS TEXT) AS queryid,
            query,
            (total_exec_time + COALESCE(total_plan_time, 0))::BIGINT AS total_time,
            calls::...
Query 7312147958645639241 (3225 calls, 1.4% DB Load): SELECT "UserActiveSessionsEntity"."id" AS "UserActiveSessionsEntity_id", "UserActiveSessionsEntity"."user_id" AS "UserActiveSessionsEntity_user_id", "UserActiveSessionsEntity"."access_token" AS "UserA...
Query 1696747180576019166 (2825 calls, 1.3% DB Load): SELECT "UserActiveSessionsEntity"."id" AS "UserActiveSessionsEntity_id", "UserActiveSessionsEntity"."user_id" AS "UserActiveSessionsEntity_user_id", "UserActiveSessionsEntity"."access_token" AS "UserA...
Query 6865378226349601843 (443719 calls, 1.3% DB Load): SELECT 1...
Query 7016532361873365759 (4056 calls, 1.1% DB Load): SELECT "UserSessionHistoryEntity"."id" AS "UserSessionHistoryEntity_id", "UserSessionHistoryEntity"."user_id" AS "UserSessionHistoryEntity_user_id", "UserSessionHistoryEntity"."session_id" AS "UserSes...
Query -299668740413496229 (1996 calls, 1.1% DB Load): SELECT DISTINCT "distinctAlias"."User_id" AS "ids_User_id" FROM (SELECT "User"."id" AS "User_id", "User"."name" AS "User_name", "User"."firstName" AS "User_firstName", "User"."lastName" AS "User_lastN...
Query 8380103491113294428 (2064 calls, 1.0% DB Load): SELECT DISTINCT "distinctAlias"."User_id" AS "ids_User_id" FROM (SELECT "User"."id" AS "User_id", "User"."name" AS "User_name", "User"."firstName" AS "User_firstName", "User"."lastName" AS "User_lastN...
Query -1883058518535594495 (18127 calls, 0.8% DB Load): select max(age(datfrozenxid)) from pg_database...
Query 8340688725808930900 (3803 calls, 0.7% DB Load): SELECT "User"."id" AS "User_id", "User"."name" AS "User_name", "User"."firstName" AS "User_firstName", "User"."lastName" AS "User_lastName", "User"."username" AS "User_username", "User"."email" AS "Us...
Query 3991043797170532806 (519 calls, 0.6% DB Load): SELECT 
                        (SELECT count(*) FROM pg_stat_activity WHERE state = $1) AS active,
                        (SELECT setting::int FROM pg_settings WHERE name = $2) AS max_conn...
Query 6337731979102480168 (106 calls, 0.5% DB Load): SELECT EXISTS(SELECT $1 FROM pg_available_extensions WHERE name = $2)...
Query -8345834931380993534 (70931 calls, 0.5% DB Load): SELECT value FROM rds_heartbeat2...
Query -1605870328763273164 (3811 calls, 0.4% DB Load): SELECT DISTINCT "distinctAlias"."User_id" AS "ids_User_id" FROM (SELECT "User"."id" AS "User_id", "User"."name" AS "User_name", "User"."firstName" AS "User_firstName", "User"."lastName" AS "User_lastN...
Query -7292323289345312841 (194 calls, 0.3% DB Load): DELETE FROM "usm-auth"."user_active_sessions" WHERE "user_id" = $1...
Query 2318934160592076983 (17733 calls, 0.2% DB Load): select coalesce(max(pg_current_wal_lsn()::pg_lsn - slots.restart_lsn), -1) as slot_byte_lag from (select restart_lsn from pg_replication_slots where restart_lsn is not null) slots...
Query -6092456872017403037 (9 calls, 0.1% DB Load): SELECT queryid, query, total_exec_time::float, calls, mean_exec_time::float 
                    FROM pg_stat_statements 
                    WHERE query NOT ILIKE $1
                      AND query N...
Query -4372904221115119073 (17733 calls, 0.1% DB Load): select pg_wal_lsn_diff(pg_current_wal_lsn(), '0/0')...
Query -7873744502202904646 (117 calls, 0.1% DB Load): INSERT INTO "usm-auth"."user_active_sessions"("id", "user_id", "access_token", "refresh_token", "created_at", "session_id", "id_token", "updated_at") VALUES (DEFAULT, $1, $2, $3, DEFAULT, $4, $5, DEFA...
Query -1295871131982273376 (519 calls, 0.1% DB Load): SELECT COALESCE(SUM(calls), $1)::float 
                        FROM pg_stat_statements...
Query 1264246089659787811 (6930 calls, 0.1% DB Load): SELECT "RolePermissionDefaultMapEntity"."id" AS "RolePermissionDefaultMapEntity_id", "RolePermissionDefaultMapEntity"."role_id" AS "RolePermissionDefaultMapEntity_role_id", "RolePermissionDefaultMapEn...
Query 1743909813400896479 (313 calls, 0.1% DB Load): SELECT "User"."id" AS "User_id", "User"."name" AS "User_name", "User"."firstName" AS "User_firstName", "User"."lastName" AS "User_lastName", "User"."username" AS "User_username", "User"."email" AS "Us...
Query -5711743491754763145 (107 calls, 0.1% DB Load): INSERT INTO "usm-auth"."user_active_sessions"("id", "user_id", "access_token", "refresh_token", "created_at", "session_id", "updated_at") VALUES (DEFAULT, $1, $2, $3, DEFAULT, $4, DEFAULT) RETURNING "...
Query 3299873911456850005 (263 calls, 0.1% DB Load): SELECT cipher, count(*) FROM pg_stat_ssl JOIN pg_stat_activity USING(pid) WHERE usename <> 'rdsadmin' AND ssl = 't' GROUP BY cipher...
Query 7431526858616955637 (1773 calls, 0.1% DB Load): SELECT count(*) FROM pg_auth_members m, pg_roles r WHERE m.roleid = r.oid AND r.rolname = 'rdsadmin'...
Query -4423847359717902379 (9 calls, 0.1% DB Load): SELECT queryid, query, total_exec_time::float, calls, mean_exec_time::float 
                    FROM pg_stat_statements 
                    ORDER BY total_exec_time DESC 
                    LIMIT $...
Query -797628640209607848 (1773 calls, 0.1% DB Load): SELECT count(*) FROM pg_roles WHERE rolsuper = 't' AND rolname != 'rdsadmin'...
Query 2488863791195940447 (224 calls, 0.1% DB Load): INSERT INTO "usm-auth"."user_session_history"("id", "user_id", "session_id", "start_time", "end_time", "created_at", "updated_at") VALUES (DEFAULT, $1, $2, DEFAULT, DEFAULT, DEFAULT, DEFAULT) RETURNIN...
Query 3250249039922133654 (6930 calls, 0.1% DB Load): SELECT "RolePermissionCustomMapEntity"."id" AS "RolePermissionCustomMapEntity_id", "RolePermissionCustomMapEntity"."tenant_id" AS "RolePermissionCustomMapEntity_tenant_id", "RolePermissionCustomMapEnt...
Query -229965859631662730 (88 calls, 0.1% DB Load): SELECT "MigratedUser"."_id" AS "MigratedUser__id", "MigratedUser"."address" AS "MigratedUser_address", "MigratedUser"."city" AS "MigratedUser_city", "MigratedUser"."company" AS "MigratedUser_company",...
Query -7822644454157818445 (5 calls, 0.1% DB Load): SELECT COUNT(*) AS total 
        FROM (
          SELECT id::text 
          FROM "usm-auth".unverified_user
          WHERE $2=$3 AND tenant_id = $1 
          
          UNION ALL

          SELECT...
Query 3811244448999515789 (167 calls, 0.1% DB Load): SELECT COUNT(*) FROM pg_stat_statements WHERE 1=1...
Query -1520521501563164402 (35466 calls, 0.1% DB Load): SELECT pg_postmaster_start_time()...
Query 1470754770176980953 (19 calls, 0.0% DB Load): SELECT 
                            n.nspname AS schemaname,
                            c.relname AS tablename,
                            COALESCE(c.reltuples::bigint, $1) AS approximate_rows,
    ...
Query -5757758298437340824 (129 calls, 0.0% DB Load): SELECT "User"."id" AS "User_id", "User"."name" AS "User_name", "User"."firstName" AS "User_firstName", "User"."lastName" AS "User_lastName", "User"."username" AS "User_username", "User"."email" AS "Us...
Query -2515714543903488028 (27 calls, 0.0% DB Load): INSERT INTO "usm-auth"."user_tenant_map"("id", "user_id", "tenant_id", "created_at", "updated_at") VALUES (DEFAULT, $1, $2, DEFAULT, DEFAULT) RETURNING "id", "created_at", "updated_at"...
Query -7925037058584461882 (1705 calls, 0.0% DB Load): CLOSE ALL...
Query -8052890271170439123 (19 calls, 0.0% DB Load): SELECT pg_size_pretty(pg_database_size(current_database()))...
Query 6865378226349601843 (6025 calls, 0.0% DB Load): SELECT $1...
Query 3749380189022910195 (17733 calls, 0.0% DB Load): ROLLBACK...
Query 6912799483820590186 (15 calls, 0.0% DB Load): SELECT name, default_version, installed_version, comment FROM pg_available_extensions WHERE name = ANY($1)...
Query 2626768141379896680 (50 calls, 0.0% DB Load): SELECT DISTINCT "distinctAlias"."User_id" AS "ids_User_id" FROM (SELECT "User"."id" AS "User_id", "User"."name" AS "User_name", "User"."firstName" AS "User_firstName", "User"."lastName" AS "User_lastN...
Query 6220375223608508244 (27 calls, 0.0% DB Load): INSERT INTO "usm-auth"."unique_user"("id", "user_id", "related_to", "created_at", "updated_at") VALUES (DEFAULT, $1, $2, DEFAULT, DEFAULT) RETURNING "id", "created_at", "updated_at"...
Query -590198278290751203 (50 calls, 0.0% DB Load): SELECT "User"."id" AS "User_id", "User"."name" AS "User_name", "User"."firstName" AS "User_firstName", "User"."lastName" AS "User_lastName", "User"."username" AS "User_username", "User"."email" AS "Us...
Query 8949810941752925112 (121 calls, 0.0% DB Load): SELECT "map"."id" AS "map_id", "map"."user_id" AS "map_user_id", "map"."tenant_id" AS "map_tenant_id", "map"."created_at" AS "map_created_at", "map"."updated_at" AS "map_updated_at" FROM "usm-auth"."u...
Query -5784974604965064336 (18 calls, 0.0% DB Load): SELECT name as setting, setting as current_value, unit 
                    FROM pg_settings 
                    WHERE name IN ($1, $2, $3, $4, $5, $6)...
Query 1239235265961668945 (25 calls, 0.0% DB Load): INSERT INTO "usm-auth"."users"("id", "name", "firstName", "lastName", "username", "email", "signUpWith", "avatar", "isDeleted", "is_tenxer_user", "created_at", "updated_at", "isMigratedUser", "isOtpEn...
Query -2832906544527294004 (42 calls, 0.0% DB Load): SELECT tc.constraint_name as constraint_name, kc.column_name as column_name FROM information_schema.table_constraints tc, information_schema.key_column_usage kc WHERE tc.constraint_type = $1 AND kc.ta...
Query 5657834343411326413 (19 calls, 0.0% DB Load): SELECT count(*) FROM information_schema.tables 
                    WHERE table_schema NOT IN ($1, $2)...
Query 2579930778211275971 (1106 calls, 0.0% DB Load): SELECT EXISTS(
                        SELECT 1 FROM pg_extension 
                        WHERE extname = 'pg_stat_statements'
                    )...
Query 6555769639653478066 (78 calls, 0.0% DB Load): SELECT "map"."id" AS "map_id", "map"."user_id" AS "map_user_id", "map"."tenant_id" AS "map_tenant_id", "map"."created_at" AS "map_created_at", "map"."updated_at" AS "map_updated_at" FROM "usm-auth"."u...
Query 5132548128899384302 (674 calls, 0.0% DB Load): SELECT "Tenant"."_id" AS "Tenant__id", "Tenant"."tenantName" AS "Tenant_tenantName", "Tenant"."contactPerson" AS "Tenant_contactPerson", "Tenant"."contactPersonEmail" AS "Tenant_contactPersonEmail", "...
Query -9024915779007967530 (3 calls, 0.0% DB Load): SELECT COUNT(*) as count FROM "usm-auth"."users" WHERE ("id"::TEXT LIKE $1) OR ("name"::TEXT LIKE $2) OR ("firstName"::TEXT LIKE $3) OR ("lastName"::TEXT LIKE $4) OR ("username"::TEXT LIKE $5) OR ("em...
Query -8679951307272332756 (1705 calls, 0.0% DB Load): SELECT pg_advisory_unlock_all()...
Query 7459448685503086950 (5 calls, 0.0% DB Load): SELECT table_name, table_schema, table_type FROM information_schema.tables...
Query 3577596510741576442 (519 calls, 0.0% DB Load): SELECT 
                        blks_hit,
                        blks_read,
                        CASE WHEN (blks_hit + blks_read) > $1 
                        THEN (blks_hit::float / (blks_hit + ...
Query 4751464073705019293 (116 calls, 0.0% DB Load): SELECT "TenantConfigEntity"."id" AS "TenantConfigEntity_id", "TenantConfigEntity"."tenant_name" AS "TenantConfigEntity_tenant_name", "TenantConfigEntity"."require_official_email" AS "TenantConfigEntit...
Query 957526381836019351 (28 calls, 0.0% DB Load): SELECT 
            CAST(queryid AS TEXT) AS queryid,
            query,
            (total_exec_time + COALESCE(total_plan_time, $2))::BIGINT AS total_time,
            calls::BIGINT,
            mea...
Query 2856671009819503160 (27 calls, 0.0% DB Load): SELECT "User"."id" AS "User_id", "User"."name" AS "User_name", "User"."firstName" AS "User_firstName", "User"."lastName" AS "User_lastName", "User"."username" AS "User_username", "User"."email" AS "Us...
Query 6489658939166418423 (14 calls, 0.0% DB Load): select pg_get_viewdef($1::regclass, $2) as create_statement...
Query -2838544918422804014 (56 calls, 0.0% DB Load): select obj_description($1, $2) as comment...
Query 7171018961984549913 (27 calls, 0.0% DB Load): SELECT DISTINCT "distinctAlias"."User_id" AS "ids_User_id" FROM (SELECT "User"."id" AS "User_id", "User"."name" AS "User_name", "User"."firstName" AS "User_firstName", "User"."lastName" AS "User_lastN...
Query 708934693888090095 (2 calls, 0.0% DB Load): select * from pg_stat_activity where state!=$1 and query not ilike$2 order by query_start desc...
Query -4552890251395767676 (1705 calls, 0.0% DB Load): UNLISTEN *...
Query 7075460498856876429 (39 calls, 0.0% DB Load): SELECT "map"."id" AS "map_id", "map"."user_id" AS "map_user_id", "map"."tenant_id" AS "map_tenant_id", "map"."created_at" AS "map_created_at", "map"."updated_at" AS "map_updated_at" FROM "usm-auth"."u...
Query 1062148080558753879 (2 calls, 0.0% DB Load): EXPLAIN (FORMAT JSON) SELECT "User"."id" AS "User_id", "User"."name" AS "User_name", "User"."firstName" AS "User_firstName", "User"."lastName" AS "User_lastName", "User"."username" AS "User_username",...
Query 669896045967967575 (42 calls, 0.0% DB Load): SELECT t.oid AS type_oid,n.nspname AS schema_name, t.typname AS type_name,e.enumlabel AS type_define FROM pg_type t JOIN pg_enum e ON e.enumtypid=t.oid JOIN pg_namespace n ON t.typnamespace = n.oid OR...
Query 5857797726677027424 (3 calls, 0.0% DB Load): EXPLAIN (FORMAT JSON) SELECT "user"."id" AS "user_id", "user"."name" AS "user_name", "user"."firstName" AS "user_firstName", "user"."lastName" AS "user_lastName", "user"."username" AS "user_username",...
Query -395771987516493817 (2 calls, 0.0% DB Load): INSERT INTO "usm-auth"."user_roles"("id", "user_id", "tenant_id", "role_id", "created_at", "updated_at") VALUES (DEFAULT, $1, $2, $3, DEFAULT, DEFAULT) RETURNING "id", "created_at", "updated_at"...
Query -7970273537031613381 (18 calls, 0.0% DB Load): SELECT "map"."id" AS "map_id", "map"."user_id" AS "map_user_id", "map"."tenant_id" AS "map_tenant_id", "map"."created_at" AS "map_created_at", "map"."updated_at" AS "map_updated_at" FROM "usm-auth"."u...
Query 3891632680465759862 (11 calls, 0.0% DB Load): SELECT SUM(total_exec_time)::float FROM pg_stat_statements...
Query 9179803178771013650 (2 calls, 0.0% DB Load): INSERT INTO "usm-auth"."email_history"("id", "tenant_id", "email", "type", "created_at", "user_id") VALUES (DEFAULT, $1, $2, $3, DEFAULT, $4) RETURNING "id", "created_at"...
Query 2789239633039111352 (14 calls, 0.0% DB Load): SELECT "UserSessionHistoryEntity"."id" AS "UserSessionHistoryEntity_id", "UserSessionHistoryEntity"."user_id" AS "UserSessionHistoryEntity_user_id", "UserSessionHistoryEntity"."session_id" AS "UserSes...
Query 924231436559426724 (519 calls, 0.0% DB Load): SELECT 
                            buffers_checkpoint,
                            buffers_clean,
                            buffers_backend,
                            checkpoints_timed,
         ...
Query -5185345822308303077 (27 calls, 0.0% DB Load): SELECT tc.constraint_name as check_constraint,pc.conkey as column_key,pg_get_expr(pc.conbin, pc.conrelid) as condition FROM information_schema.table_constraints AS tc JOIN pg_constraint AS pc ON pc.co...
Query -6893372869065970 (1 calls, 0.0% DB Load): EXPLAIN (FORMAT JSON) SELECT "User"."id" AS "User_id", "User"."name" AS "User_name", "User"."firstName" AS "User_firstName", "User"."lastName" AS "User_lastName", "User"."username" AS "User_username",...
Query 7435351042725952479 (88 calls, 0.0% DB Load): SELECT "Permission"."id" AS "Permission_id", "Permission"."name" AS "Permission_name", "Permission"."display_name" AS "Permission_display_name", "Permission"."description" AS "Permission_description",...
Query 6305059191163812176 (1 calls, 0.0% DB Load): INSERT INTO "usm-auth"."users"("id", "name", "firstName", "lastName", "username", "email", "signUpWith", "avatar", "isDeleted", "is_tenxer_user", "created_at", "updated_at", "isMigratedUser", "isOtpEn...
Query -4880664725903476643 (18 calls, 0.0% DB Load): SELECT 
                        s.schemaname as schema, 
                        s.relname as table, 
                        s.indexrelname as index,
                        s.idx_scan as scans,
    ...
Query 91640987004403025 (29 calls, 0.0% DB Load): select pg_get_functiondef($1)AS create_function...
Query 7461524595420343917 (562 calls, 0.0% DB Load): START TRANSACTION...
Query -9151433896731388150 (2 calls, 0.0% DB Load): SELECT "ExternalUserEntity"."id" AS "ExternalUserEntity_id", "ExternalUserEntity"."external_user_id" AS "ExternalUserEntity_external_user_id", "ExternalUserEntity"."myrenesas_id" AS "ExternalUserEntit...
Query -8821953382296511278 (141 calls, 0.0% DB Load): SELECT "TenantDomainMap"."id" AS "TenantDomainMap_id", "TenantDomainMap"."tenant_id" AS "TenantDomainMap_tenant_id", "TenantDomainMap"."domain" AS "TenantDomainMap_domain", "TenantDomainMap"."created_...
Query 5535647736707082079 (8 calls, 0.0% DB Load): CREATE EXTENSION IF NOT EXISTS "uuid-ossp"...
Query 3964424132406416553 (6 calls, 0.0% DB Load): SELECT "User"."id" AS "User_id", "User"."name" AS "User_name", "User"."firstName" AS "User_firstName", "User"."lastName" AS "User_lastName", "User"."username" AS "User_username", "User"."email" AS "Us...
Query -8966780846911220743 (1 calls, 0.0% DB Load): INSERT INTO "usm-auth"."unverified_user"("id", "email", "tenant_id", "otp_sent_time", "created_at", "updated_at") VALUES (DEFAULT, $1, $2, $3, DEFAULT, DEFAULT) RETURNING "id", "created_at", "updated_...
Query 5183996730751370836 (4 calls, 0.0% DB Load): SELECT "table_schema", "table_name", obj_description(($1 || "table_schema" || $2 || "table_name" || $3)::regclass, $4) AS table_comment FROM "information_schema"."tables" WHERE ("table_schema" = $5 AN...
Query 3281259693998624439 (1 calls, 0.0% DB Load): EXPLAIN (FORMAT JSON) SELECT count(*) FROM pg_show_all_settings() WHERE name = $1 AND setting SIMILAR TO $2...
Query -2271141028522658140 (29 calls, 0.0% DB Load): SELECT "map"."id" AS "map_id", "map"."user_id" AS "map_user_id", "map"."tenant_id" AS "map_tenant_id", "map"."created_at" AS "map_created_at", "map"."updated_at" AS "map_updated_at" FROM "usm-auth"."u...
Query -4102085523153110114 (1 calls, 0.0% DB Load): SELECT name, setting, unit, context
                FROM pg_settings
                WHERE name IN (
                    $1,
                    $2,
                    $3,
                    $4,
   ...
Query -847260294704137480 (144 calls, 0.0% DB Load): SELECT "RolePermissionDefaultMapEntity"."id" AS "RolePermissionDefaultMapEntity_id", "RolePermissionDefaultMapEntity"."role_id" AS "RolePermissionDefaultMapEntity_role_id", "RolePermissionDefaultMapEn...
Query 7359200663062500966 (1 calls, 0.0% DB Load): SELECT "user"."id" AS "user_id", "user"."name" AS "user_name", "user"."firstName" AS "user_firstName", "user"."lastName" AS "user_lastName", "user"."username" AS "user_username", "user"."email" AS "us...
Query 1555767856989919166 (5 calls, 0.0% DB Load): SELECT p.oid AS oid, p.relname AS table_name, n.nspname as table_schema FROM pg_class AS p JOIN pg_namespace AS n ON p.relnamespace=n.oid WHERE p.relkind=$1 OR p.relkind=$2 OR p.relkind=$3...
Query 7045927928305507194 (3 calls, 0.0% DB Load): SELECT hypopg_create_index($1)...
Query -5590005995855555004 (1 calls, 0.0% DB Load): SELECT 
                    schemaname,
                    relname AS tablename,
                    indexrelname AS indexname,
                    idx_scan,
                    idx_tup_read,
       ...
Query -6302480767445613467 (4 calls, 0.0% DB Load): SELECT "Role"."id" AS "Role_id", "Role"."name" AS "Role_name", "Role"."display_name" AS "Role_display_name", "Role"."description" AS "Role_description", "Role"."type" AS "Role_type", "Role"."created_a...
Query 4785509292391772206 (3 calls, 0.0% DB Load): SELECT "UserExtEntity"."id" AS "UserExtEntity_id", "UserExtEntity"."phone" AS "UserExtEntity_phone", "UserExtEntity"."about" AS "UserExtEntity_about", "UserExtEntity"."official_email" AS "UserExtEntit...
Query -6369648110671427487 (1 calls, 0.0% DB Load): INSERT INTO "usm-auth"."user_preference"("id", "auth_password", "user_id", "auth_otp", "newsletter", "language_preference", "created_at", "updated_at") VALUES (DEFAULT, DEFAULT, $1, DEFAULT, $2, DEFAU...
Query 3264128256879073719 (73 calls, 0.0% DB Load): SELECT inet_server_addr(), inet_server_port()...
Query 1404255267631911711 (42 calls, 0.0% DB Load): SELECT column_name, data_type, is_nullable
                    FROM information_schema.columns 
                    WHERE table_schema = $1 AND table_name = $2
                    ORDER BY ordinal_pos...
Query -6480462097315103555 (2 calls, 0.0% DB Load): SELECT "User"."id" AS "User_id", "User"."name" AS "User_name", "User"."firstName" AS "User_firstName", "User"."lastName" AS "User_lastName", "User"."username" AS "User_username", "User"."email" AS "Us...
Query 4156335914645203569 (98 calls, 0.0% DB Load): SELECT slot_name, restart_lsn FROM pg_replication_slots WHERE active='f' AND restart_lsn IS NOT NULL AND slot_name NOT LIKE '%ap_south_1%'...
Query 6410615003924057466 (2 calls, 0.0% DB Load): INSERT INTO "usm-auth"."otp_store"("id", "email", "tenant_id", "user_id", "otp", "exitTime", "created_at") VALUES (DEFAULT, $1, $2, DEFAULT, $3, $4, DEFAULT) RETURNING "id", "created_at"...
Query -8414359965388285086 (17 calls, 0.0% DB Load): SELECT "Tenant"."_id" AS "Tenant__id", "Tenant"."tenantName" AS "Tenant_tenantName", "Tenant"."contactPerson" AS "Tenant_contactPerson", "Tenant"."contactPersonEmail" AS "Tenant_contactPersonEmail", "...
Query 4072386785132338349 (44 calls, 0.0% DB Load): SELECT "Role"."id" AS "Role_id", "Role"."name" AS "Role_name", "Role"."display_name" AS "Role_display_name", "Role"."description" AS "Role_description", "Role"."type" AS "Role_type", "Role"."created_a...
Query 2989643603857720205 (1 calls, 0.0% DB Load): INSERT INTO "usm-auth"."external_users"("id", "external_user_id", "myrenesas_id", "created_at", "updated_at", "userId") VALUES (DEFAULT, $1, $2, DEFAULT, DEFAULT, $3) RETURNING "id", "created_at", "up...
Query -4148659287643534245 (4 calls, 0.0% DB Load): SELECT "ns"."nspname" AS "table_schema", "t"."relname" AS "table_name", "cnst"."conname" AS "constraint_name", pg_get_constraintdef("cnst"."oid") AS "expression", CASE "cnst"."contype" WHEN $1 THEN $2...
Query -8031365774649418891 (19 calls, 0.0% DB Load): SELECT extname, extversion 
                    FROM pg_extension 
                    ORDER BY extname...
Query -309701458997210406 (32 calls, 0.0% DB Load): SELECT count(*) FROM pg_extension WHERE extname = $1...
Query -329062654588359859 (3 calls, 0.0% DB Load): SELECT oid, typname FROM pg_type WHERE typname=$1 OR typname=$2...
Query 7914111474195949513 (2 calls, 0.0% DB Load): SELECT COUNT(*) as count FROM "usm-auth"."users"...
Query 5281769710364840075 (1 calls, 0.0% DB Load): EXPLAIN (FORMAT JSON) SELECT "MigratedUser"."_id" AS "MigratedUser__id", "MigratedUser"."address" AS "MigratedUser_address", "MigratedUser"."city" AS "MigratedUser_city", "MigratedUser"."company" AS "...
Query -9028473436336712452 (1 calls, 0.0% DB Load): INSERT INTO "usm-auth"."users"("id", "name", "firstName", "lastName", "username", "email", "signUpWith", "avatar", "isDeleted", "is_tenxer_user", "created_at", "updated_at", "isMigratedUser", "isOtpEn...
Query 7169057023018701460 (42 calls, 0.0% DB Load): SELECT c.reltuples::BIGINT
                    FROM pg_class c
                    JOIN pg_namespace n ON n.oid = c.relnamespace
                    WHERE n.nspname = $1 AND c.relname = $2...
Query -3205543232051730490 (3 calls, 0.0% DB Load): EXPLAIN SELECT "MigratedUser"."_id" AS "MigratedUser__id", "MigratedUser"."address" AS "MigratedUser_address", "MigratedUser"."city" AS "MigratedUser_city", "MigratedUser"."company" AS "MigratedUser_c...
Query 7853120809816534341 (4 calls, 0.0% DB Load): SELECT $1 FROM information_schema.columns WHERE table_name = $2 and column_name = $3...
Query -8680595711232584069 (42 calls, 0.0% DB Load): SELECT indexname, indexdef
                    FROM pg_indexes
                    WHERE schemaname = $1 AND tablename = $2...
Query -9027015998477660513 (92 calls, 0.0% DB Load): SELECT current_database()...
Query 3775121917853451189 (4 calls, 0.0% DB Load): DELETE FROM "usm-auth"."otp_store" WHERE "email" = $1...
Query -392298418424131199 (15 calls, 0.0% DB Load): SELECT rolname FROM pg_roles WHERE pg_has_role(CURRENT_USER, oid, $1)...
Query 6374415760832333826 (1 calls, 0.0% DB Load): SELECT table_name, table_schema, table_type FROM information_schema.tables WHERE table_schema=$1...
Query 2594216163164458141 (4 calls, 0.0% DB Load): SELECT "ns"."nspname" AS "table_schema", "t"."relname" AS "table_name", "i"."relname" AS "constraint_name", "a"."attname" AS "column_name", CASE "ix"."indisunique" WHEN $1 THEN $2 ELSE$3 END AS "is_un...
Query 3385157386731679198 (73 calls, 0.0% DB Load): SELECT current_user...
Query -5680083913026976598 (23 calls, 0.0% DB Load): SELECT "UserExtEntity"."id" AS "UserExtEntity_id", "UserExtEntity"."phone" AS "UserExtEntity_phone", "UserExtEntity"."about" AS "UserExtEntity_about", "UserExtEntity"."official_email" AS "UserExtEntit...
Query 2218282537217061800 (12 calls, 0.0% DB Load): SELECT * FROM current_schema()...
Query 673306510854497646 (1 calls, 0.0% DB Load): EXPLAIN (FORMAT JSON) SELECT "UserRolesEntity"."id" AS "UserRolesEntity_id", "UserRolesEntity"."user_id" AS "UserRolesEntity_user_id", "UserRolesEntity"."tenant_id" AS "UserRolesEntity_tenant_id", "Us...
Query -4684746887305924165 (4 calls, 0.0% DB Load): SELECT "con"."conname" AS "constraint_name", "con"."nspname" AS "table_schema", "con"."relname" AS "table_name", "att2"."attname" AS "column_name", "ns"."nspname" AS "referenced_table_schema", "cl"."r...
Query 704524028046448330 (14 calls, 0.0% DB Load): SELECT "UserSessionHistoryEntity"."id" AS "UserSessionHistoryEntity_id", "UserSessionHistoryEntity"."user_id" AS "UserSessionHistoryEntity_user_id", "UserSessionHistoryEntity"."session_id" AS "UserSes...
Query -7881096560793242789 (15 calls, 0.0% DB Load): SELECT usesuper FROM pg_user WHERE usename = CURRENT_USER...
Query 2051872835152361448 (3 calls, 0.0% DB Load): SELECT "UnverifiedUserEntity"."id" AS "UnverifiedUserEntity_id", "UnverifiedUserEntity"."email" AS "UnverifiedUserEntity_email", "UnverifiedUserEntity"."tenant_id" AS "UnverifiedUserEntity_tenant_id",...
Query 4976858042331007711 (15 calls, 0.0% DB Load): SELECT extname, extversion FROM pg_extension WHERE extname = ANY($1)...
Query -8670461570743341737 (2 calls, 0.0% DB Load): SELECT "Otp"."id" AS "Otp_id", "Otp"."email" AS "Otp_email", "Otp"."tenant_id" AS "Otp_tenant_id", "Otp"."user_id" AS "Otp_user_id", "Otp"."otp" AS "Otp_otp", "Otp"."exitTime" AS "Otp_exitTime", "Otp"...
Query -8144780240757866785 (1 calls, 0.0% DB Load): EXPLAIN (FORMAT JSON) SELECT "User"."id" AS "User_id", "User"."name" AS "User_name", "User"."firstName" AS "User_firstName", "User"."lastName" AS "User_lastName", "User"."username" AS "User_username",...
Query 1543879138731204692 (1 calls, 0.0% DB Load): SELECT COUNT(*) as count FROM "usm-auth"."unique_user"...
Query -2885330479908940062 (30 calls, 0.0% DB Load): SELECT version()...
Query -169511899476696632 (5 calls, 0.0% DB Load): SELECT "UserPreferenceEntity"."id" AS "UserPreferenceEntity_id", "UserPreferenceEntity"."auth_password" AS "UserPreferenceEntity_auth_password", "UserPreferenceEntity"."user_id" AS "UserPreferenceEnti...
Query 2503709131406890069 (7 calls, 0.0% DB Load): SELECT "User"."id" AS "User_id", "User"."name" AS "User_name", "User"."firstName" AS "User_firstName", "User"."lastName" AS "User_lastName", "User"."username" AS "User_username", "User"."email" AS "Us...
Query 4549634338148722033 (6 calls, 0.0% DB Load): SELECT "User"."sso_provider" AS "User_sso_provider", "User"."sso_subject_id" AS "User_sso_subject_id", "User"."sso_issuer" AS "User_sso_issuer", "User"."id" AS "User_id" FROM "usm-auth"."users" "User"...
Query -5515428254828143185 (2 calls, 0.0% DB Load): SELECT "ExternalUserEntity"."id" AS "ExternalUserEntity_id", "ExternalUserEntity"."external_user_id" AS "ExternalUserEntity_external_user_id", "ExternalUserEntity"."myrenesas_id" AS "ExternalUserEntit...
Query 8658705369131486966 (5 calls, 0.0% DB Load): SELECT "User"."id" AS "User_id", "User"."name" AS "User_name", "User"."firstName" AS "User_firstName", "User"."lastName" AS "User_lastName", "User"."username" AS "User_username", "User"."email" AS "Us...
Query 1264369451806247074 (1 calls, 0.0% DB Load): SELECT p.oid AS oid, p.relname AS table_name, n.nspname as table_schema FROM pg_class AS p JOIN pg_namespace AS n ON p.relnamespace=n.oid WHERE n.nspname=$1 AND (p.relkind=$2 OR p.relkind=$3 OR p.relk...
Query 9152041851530609447 (11 calls, 0.0% DB Load): SELECT
                        current_setting($1) AS cur,
                        set_config($2, $3, $4) AS new...
Query 6305126217644522640 (3 calls, 0.0% DB Load): SELECT "UserPreferenceEntity"."id" AS "UserPreferenceEntity_id", "UserPreferenceEntity"."auth_password" AS "UserPreferenceEntity_auth_password", "UserPreferenceEntity"."user_id" AS "UserPreferenceEnti...
Query 1189136738064424773 (1 calls, 0.0% DB Load): SELECT pg_stat_statements_reset()...
Query -4950540389668452132 (5 calls, 0.0% DB Load): SELECT DISTINCT "distinctAlias"."User_id" AS "ids_User_id" FROM (SELECT "User"."id" AS "User_id", "User"."name" AS "User_name", "User"."firstName" AS "User_firstName", "User"."lastName" AS "User_lastN...
Query -6938891720236852341 (4 calls, 0.0% DB Load): SELECT "RolePermissionCustomMapEntity"."id" AS "RolePermissionCustomMapEntity_id", "RolePermissionCustomMapEntity"."tenant_id" AS "RolePermissionCustomMapEntity_tenant_id", "RolePermissionCustomMapEnt...
Query 1708853975061214229 (1 calls, 0.0% DB Load): SELECT pg_cancel_backend($1)...
Query -7770186396568111776 (3 calls, 0.0% DB Load): SELECT "User"."id" AS "User_id", "User"."name" AS "User_name", "User"."firstName" AS "User_firstName", "User"."lastName" AS "User_lastName", "User"."username" AS "User_username", "User"."email" AS "Us...
Query -9126659699452262960 (5 calls, 0.0% DB Load): SELECT "user_tenant_map"."id" AS "id", "user_tenant_map"."user_id" AS "user_id" FROM "usm-auth"."user_tenant_map" "user_tenant_map" WHERE (("user_tenant_map"."user_id" = $1))...
Query 6865378226349601843 (8 calls, 0.0% DB Load): SELECT $1...
Query 6865378226349601843 (8 calls, 0.0% DB Load): SELECT $1...
Query 8384749904843327003 (1 calls, 0.0% DB Load): SELECT "ExternalUserEntity"."id" AS "ExternalUserEntity_id", "ExternalUserEntity"."external_user_id" AS "ExternalUserEntity_external_user_id", "ExternalUserEntity"."myrenesas_id" AS "ExternalUserEntit...
Query -734758282273954059 (2 calls, 0.0% DB Load): SELECT COUNT(*) as count FROM "public"."hypopg_hidden_indexes"...
Query -8265957695346911831 (2 calls, 0.0% DB Load): DELETE FROM "usm-auth"."unverified_user" WHERE "email" = $1...
Query 6992108127473634479 (2 calls, 0.0% DB Load): SELECT "User"."id" AS "User_id", "User"."name" AS "User_name", "User"."firstName" AS "User_firstName", "User"."lastName" AS "User_lastName", "User"."username" AS "User_username", "User"."email" AS "Us...
Query -801038013806873019 (2 calls, 0.0% DB Load): SELECT COUNT(*) as count FROM "usm"."tenant"...
Query 4227534702185571849 (4 calls, 0.0% DB Load): SELECT * FROM "information_schema"."tables" WHERE "table_schema" = $1 AND "table_name" = $2...
Query -2833458828444839287 (4 calls, 0.0% DB Load): SELECT * FROM current_database()...
Query -5487574547189806953 (1 calls, 0.0% DB Load): SELECT "User"."id" AS "User_id", "User"."email" AS "User_email", "User"."signUpWith" AS "User_signUpWith", "User"."is_external" AS "User_is_external", "User"."sso_provider" AS "User_sso_provider", "Us...
Query 5876227417188328036 (2 calls, 0.0% DB Load): SELECT "UserTenantMapEntity"."id" AS "UserTenantMapEntity_id", "UserTenantMapEntity"."user_id" AS "UserTenantMapEntity_user_id", "UserTenantMapEntity"."tenant_id" AS "UserTenantMapEntity_tenant_id", "...
Query 5204333201913935572 (1 calls, 0.0% DB Load): SELECT COUNT(*) as count FROM "usm-auth"."global_config"...
Query -2476547241887543597 (1 calls, 0.0% DB Load): SELECT COUNT(*) as count FROM "public"."hypopg_list_indexes"...
Query -3593539205527747641 (1 calls, 0.0% DB Load): SELECT COUNT(*) as count FROM "public"."user_entity"...
Query -7033425212157219767 (1 calls, 0.0% DB Load): SELECT hypopg_reset()...

2. BLOAT: [<Record schemaname='usm-auth' table='user_secretes' live_tuples=246 dead_tuples=57 dead_ratio=23.17 last_autovacuum=None>, <Record schemaname='usm-auth' table='user_active_sessions' live_tuples=7222 dead_tuples=287 dead_ratio=3.97 last_autovacuum=datetime.datetime(2025, 12, 10, 7, 8, 55, 783544, tzinfo=datetime.timezone.utc)>, <Record schemaname='usm-auth' table='users' live_tuples=2968 dead_tuples=74 dead_ratio=2.49 last_autovacuum=datetime.datetime(2025, 8, 13, 11, 55, 43, 294333, tzinfo=datetime.timezone.utc)>]
3. CONFIG: [<Record setting='autovacuum_vacuum_scale_factor' current_value='0.1' unit=None>, <Record setting='effective_cache_size' current_value='46162' unit='8kB'>, <Record setting='maintenance_work_mem' current_value='65536' unit='kB'>, <Record setting='max_connections' current_value='79' unit=None>, <Record setting='shared_buffers' current_value='23081' unit='8kB'>, <Record setting='work_mem' current_value='4096' unit='kB'>]
4. UNUSED INDEXES: []

YOUR GOAL: 
Explain the score and prioritize the issues. 
If a query has high 'DB Load %' (even if low latency), it is a CRITICAL optimization target. 
Demand specific fixes (like "Add index for join") in your explanation.

OUTPUT JSON FORMAT:
{
  "health_score": 90,
  "issues": [
    {
      "type": "QUERY" | "CONFIG" | "SCHEMA",
      "severity": "CRITICAL" | "WARNING" | "INFO",
      "title": "Title",
      "description": "Explain WHY this matters based on stats.",
      "action_payload": "Context"
    }
  ]
}

STRICT RULES FOR 'type' AND 'action_payload':
1. type="QUERY": Use ONLY for specific slow/heavy queries from the WORKLOAD SUMMARY.
   - action_payload MUST be the 'queryid' (e.g., "123456789"). DO NOT put SQL here.
2. type="SCHEMA": Use for Bloat, Vacuum, or Missing Index issues.
   - action_payload MUST be the generic SQL command to fix it (e.g., "VACUUM FULL public.users;", "CREATE INDEX ON...").
3. type="CONFIG": Use for Postgres settings (work_mem, etc).
   - action_payload MUST be the SQL command to change it (e.g., "ALTER SYSTEM SET work_mem = '64MB';").
}
